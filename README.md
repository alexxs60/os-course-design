# 操作系统课程设计 - 文件系统模块

项目名称：模拟文件系统（Virtual File System Simulator）  
课程：操作系统  
选题方向：文件系统 + 位图管理、索引结构、文件操作  
个人负责部分：文件系统核心实现（filesystem.py）  
实现语言：Python 3  
完成时间：2026年  

## 项目概述

本项目为操作系统课程设计小组作业，模拟了一个完整的用户态虚拟文件系统。  
我个人独立负责并完成了文件系统的核心模块（filesystem.py），包括磁盘布局设计、元数据管理、块分配与回收、文件全生命周期操作等功能。  
该模块从零实现，支持线程安全、元数据持久化、空间高效回收，并通过位图 + 直接/间接索引结构实现文件存储管理。

## 我负责的核心功能（filesystem.py）

- 虚拟磁盘模拟（基于 virtual_disk.dat 文件）
- 超级块（SuperBlock）设计与序列化/反序列化
- 位图（Bitmap）管理：空闲块查找、分配、释放、统计
- iNode 结构设计：支持 10 个直接块 + 1 级间接索引（16 个间接块）
- 文件完整操作：
  - 创建文件（自动分配块、写入初始内容）
  - 读取文件整体内容或指定块内容
  - 覆盖/追加写入文件（支持文件扩展或收缩，自动调整占用块）
  - 修改文件指定块内容（同时更新文件大小）
  - 删除文件（安全释放所有数据块和间接索引块）
- 文件保护机制：引用计数（ref_count），防止正在使用的文件被删除
- 基本文件权限控制（读/写/执行）
- 目录列表功能：显示所有文件的信息（名称、大小、占用块数、创建/修改时间、权限等）
- 磁盘整体信息统计（总块数、空闲块数、iNode 使用情况）
- 位图状态获取（可用于可视化展示）
- 并发安全：使用 RLock 保护共享资源和磁盘操作

## 系统关键参数

- 总盘块数：1024 个
- 每个块大小：64 字节
- 磁盘布局：
  - 块 0：超级块
  - 块 1–2：位图区
  - 块 3–34：iNode 区（共 32 个 iNode，每个占 1 整块，64 字节）
  - 块 35–1023：数据区（989 个可用数据块）

## 如何运行测试

1. 进入项目目录
cd os-course-design
text2. 直接运行文件系统核心代码
python filesystem.py
text运行后会自动：
- 挂载或格式化虚拟磁盘
- 创建测试文件
- 进行读写/修改/删除操作
- 输出目录列表和磁盘使用情况

## 项目文件说明（重点突出我负责部分）

- filesystem.py          → 文件系统核心实现（我负责的全部内容）
- gui.py / main_gui.py   → 可选图形界面（其他组员负责）
- async_io.py 等         → 异步 I/O、管道等扩展实验（其他组员负责）
- virtual_disk.dat       → 运行时生成的虚拟磁盘文件（.gitignore 已忽略，不上传）

## 总结

文件系统模块（filesystem.py）是我在本项目中的主要贡献，完整实现了从磁盘格式化到文件读写删除的闭环逻辑，重点覆盖了位图管理、一级间接索引、块分配回收、元数据持久化等操作系统文件系统核心知识点。  
代码中添加了大量注释，便于理解底层实现细节。

欢迎各位查看与指导！

作者：kira (@alexxs60)  
最后更新：2026 年 2 月
